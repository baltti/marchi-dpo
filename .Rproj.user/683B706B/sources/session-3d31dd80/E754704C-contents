---
title: "Распознавание объектов на снимках"
format: html
---

# Модуль от Mapflow AI

***Mapflow*** от компании GeoAlert - платформа для распознавания объектов на спутниковых снимках.

Сайт платформы - <https://mapflow.ai/ru>

На платформе реализованы модели сегментации, позволяющие распознавать на снимках:

-   контура фундаментов зданий;

-   различные типы лесной растительности;

-   строительные площадки;

-   дороги;

-   сельскохозяйственные поля.

Подробная документация по работе с модулем приведена по [ссылке](https://docs.mapflow.ai/api/qgis_mapflow.html).

После регистрации на платформе вы можете использовать ее напрямую в браузере или с помощью одноименного модуля для QGIS.

::: callout-warning
Регистрация на платформе является обязательным условием использования сервиса, даже при работе через модуль.
:::

![](images/Снимок%20экрана%202025-03-04%20в%2013.32.35.png){fig-align="center"}

После установки значок модуля должен появиться в основной панели инструментов ![](images/Снимок%20экрана%202025-03-04%20в%2013.32.53.png){width="47"}.

При первом запуске модуля вы увидите окно, в котором необходимо ввести ваш личный API токен для доступа к сервису.

![](images/login_window_w_oauth.png){fig-align="center"}

::: callout-warning
Сервис не работает через прокси.
:::

Основное окно плагина содержит две основных панели:

-   панель процессинга;

-   вкладки с прочими настройками и источниками.

![](images/main_window.png){fig-align="center"}

Панель процессинга позволяет настроить обработку изображений.

+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Name of the field / button** | **Description**                                                                                                                                                                                                                                                               | Описание                                                                                                                                                                                         |
+================================+===============================================================================================================================================================================================================================================================================+==================================================================================================================================================================================================+
| Processing name                | Name of your processing                                                                                                                                                                                                                                                       | Пользовательское название процесса                                                                                                                                                               |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Area                           | The area to be processed. This layer is automatically displayed in the drop-down list from the list of QGIS vector layers.                                                                                                                                                    | Область для обработки                                                                                                                                                                            |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Data source                    | Base imagery to be processed. By default Mapbox is selected, in the drop-down list you can also select satellite images of the commercial providers. You can open your image through the additional options button.                                                           | Источник данных для обработки. По умолчанию используется Mapbox, но доступен выбор других коммерческих провайдеров, а также вы можете открыть собственное изображение.                           |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Show preview                   | A preview of your data source or, if it is not available, an OpenStreetMap basemap                                                                                                                                                                                            | Превью источника данных, при его отсутствии OpenStreetMap                                                                                                                                        |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Use image extent               | This area becomes active if processing is performed on the .tif file. Allows you not to create an additional vector layer processing area for this image but takes its extent.                                                                                                | Использовать охват изображения. Становится активным только при использовании .tif. Позволяет не создавать отдельный слой для задания области обработки, а просто использовать охват изображения. |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Processing area                | Automatic calculation of the area of the selected processing area.                                                                                                                                                                                                            | Область обработки                                                                                                                                                                                |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| AI Model                       | Processing type. In the drop-down list, you can select the following processing types (default list of processing scenarios): Building Detection, Roads Detection, Forest Detection, Forest Detection With Heights, Construction Detection, Fields Detection.                 | Тип используемой модели. Список моделей по умолчанию:                                                                                                                                            |
|                                |                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                  |
|                                |                                                                                                                                                                                                                                                                               | -   детекция зданий;                                                                                                                                                                             |
|                                |                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                  |
|                                |                                                                                                                                                                                                                                                                               | -   детекция дорог;                                                                                                                                                                              |
|                                |                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                  |
|                                |                                                                                                                                                                                                                                                                               | -   детекция лесной растительности;                                                                                                                                                              |
|                                |                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                  |
|                                |                                                                                                                                                                                                                                                                               | -   детекция лесной растительности с высотами древостоя;                                                                                                                                         |
|                                |                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                  |
|                                |                                                                                                                                                                                                                                                                               | -   детекция стройплощадок;                                                                                                                                                                      |
|                                |                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                  |
|                                |                                                                                                                                                                                                                                                                               | -   детекция полей.                                                                                                                                                                              |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Your balance                   | Remaining area available for processing                                                                                                                                                                                                                                       | Оставшееся количество кредитов для процессинга                                                                                                                                                   |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Start processing               | New processing start button. You will see a notification about the successful start of processing, or about incorrectly selected parameters after clicking it. It will appear in the block for displaying and working with processing after a successful start of processing. | Кнопка старта обработки                                                                                                                                                                          |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Stars for rating               | Rating scores for the finished processing                                                                                                                                                                                                                                     | Рейтинг обработки                                                                                                                                                                                |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Feedback field                 | Comments about rating                                                                                                                                                                                                                                                         | Комментарии                                                                                                                                                                                      |
+--------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

::: callout-note
Сервис является условно бесплатным, то есть при регистрации вы получаете 250 кредитов для обработки, после их использования можно пополнять свой баланс в личном кабинете.

Стоимость обработки рассчитывается по формуле[^1]:

`Стоимость = Площадь * (Стоимость обработки + Стоимость данных)`

+-------------------+------------------+------------------------------+
| **Модель**        | **Базовая цена** | **Пост-процессинг**          |
+===================+==================+==============================+
| Здания            | 5                | | Классификация: 0           |
|                   |                  | | Симплификация: 3           |
|                   |                  | | Высоты зданий: 20          |
|                   |                  | | Склейка с OpenSteeetMap: 0 |
+-------------------+------------------+------------------------------+
| Здания (Аэрофото) | 25               | | Симплификация: 3           |
+-------------------+------------------+------------------------------+
| Строительство     | 4                | \-                           |
+-------------------+------------------+------------------------------+
| Лес               | 8                | Классификация по Высотам: 20 |
+-------------------+------------------+------------------------------+
| Дороги            | 5                | \-                           |
+-------------------+------------------+------------------------------+

При использовании поставщиков данных по умолчанию (Mapbox, Arcgis Satellite), собственного источника TMS или загруженных изображений цена равна нулю. Если вы используете коммерческих поставщиков («Global mosaic» и другие, которые могут быть доступны), стоимость данных зависит от уровня масштабирования. Мы сотрудничаем с поставщиками данных, а это означает, что стоимость услуги зависит от платного трафика, поэтому мы масштабируем цены в зависимости от разрешения изображения для более точной модели ценообразования.

| **Поставщик данных**  | **18 zoom** | **17 zoom** | **16 zoom** |
|-----------------------|-------------|-------------|-------------|
| Mapbox                | 0           | 0           | 0           |
| ArcGIS WorldView      | 0           | 0           | 0           |
| Ваш источник          | 0           | 0           | 0           |
| Ваше изображение TIFF | 0           | 0           | 0           |
| Global mosaic         | 10          | 2.5         | 1           |

*Пример расчета стоимости обработки*

*Я хочу обработать 3.3 кв.км данных Global Mosaic на 18 зуме использую модель Зданий*

`Стоимость = 3.3 * (10+5) = 50 кредитов`
:::

[^1]: <https://ru.docs.mapflow.ai/userguides/prices.html>

В правой части окна 5 основных вкладок:

-   Processing (Обработка)

![](images/processing_tab.png){fig-align="center"}

+-----------------------+-------------------------------------------------------+---------------------------+
| **Name of the field** | **Description**                                       | Описание                  |
+=======================+=======================================================+===========================+
| Name                  | Your processing name.                                 | Имя обработки             |
+-----------------------+-------------------------------------------------------+---------------------------+
| Model                 | User-selected item from the list of available models. | Используемая модель       |
+-----------------------+-------------------------------------------------------+---------------------------+
| Status                | Processing status: IN_PROGRESS, OK, FAILED.           | Статус обработки          |
+-----------------------+-------------------------------------------------------+---------------------------+
| Progress              | The percentage of completeness of the processing.     | Процент завершенности     |
+-----------------------+-------------------------------------------------------+---------------------------+
| Area                  | The processing area (AOI).                            | Площадь области обработки |
+-----------------------+-------------------------------------------------------+---------------------------+
| Created               | The date-time of the processing creation.             | Дата обработки            |
+-----------------------+-------------------------------------------------------+---------------------------+

+------------------------+-------------------------------------------------------------------------------------------+---------------------------------------+
| **Name of the button** | **Description**                                                                           | Описание                              |
+========================+===========================================================================================+=======================================+
| View results           | Shows the results of completed processing in QGIS layers.                                 | Отображение результатов               |
+------------------------+-------------------------------------------------------------------------------------------+---------------------------------------+
| Delete                 | Deletes selected processing/processings.                                                  | Удаление обработок                    |
+------------------------+-------------------------------------------------------------------------------------------+---------------------------------------+
| Save results           | Saves processing results to GeoJSON file.                                                 | Сохранение результатов                |
+------------------------+-------------------------------------------------------------------------------------------+---------------------------------------+
| Download AOI           | Adds processing AOI to qgis as a layer, for further work or export.                       | Добавление области обработки как слой |
+------------------------+-------------------------------------------------------------------------------------------+---------------------------------------+
| See details            | Shows information about processing (*Name, Status, Model, Model options, Data provider*). | Информация об обработке               |
+------------------------+-------------------------------------------------------------------------------------------+---------------------------------------+
| Rename                 | Renames your processing.                                                                  | Переименование                        |
+------------------------+-------------------------------------------------------------------------------------------+---------------------------------------+

-   Imagery search (Поиск снимков)

![](images/Providers_tab.png){fig-align="center"}

-   My imagery (Мои снимки)

![Основной сценарий работы с собственными снимками](images/my_imagery_scenario.png){fig-align="center"}

![](images/my_imagery_main.png){fig-align="center"}

![Обработка собственных снимков](images/my_imagery_images.png){fig-align="center"}

![](images/my_imagery_run.png){fig-align="center"}

-   Settings

![](images/settings_tab_w_projects.png){fig-align="center"}

-   Help

Для начала обработки изображений необходимо выбрать интересующуя вас область. Это можно сделать несколькими способами:

1.  создать новую область по охвату карты;
2.  добавить полигон из векторного файла;
3.  нарисовать область на карте;
4.  использовать охват снимка.

![](images/AOI_button.png){fig-align="center"}

Далее следует найти подходящий снимок:

1.  переключиться на вкладку “Imagery Search”;
2.  установить параметры поиска, включая область, период времени, облачность и процент пересечения с областью исследования;
3.  выбрать мозаику (“Product type = Mosaic”), в окне появится изображение и край конкретного снимка.

![](images/qgis_mosaic_search.jpg){fig-align="center"}

После обработки вы увидите результат в месте пересечения снимка и области исследования.

![](images/qgis_mosaic_results.jpg){fig-align="center"}

Источники данных по умолчанию:

-   [Mapbox Satellite](https://mapbox.com/maps/ssatellite) - провайдер глоабльных данных высокого размершения (нельзя выбирать изображение и дату съемки);

-   **“Global mosaic”** - пробная версия мозаики снимков высокого разрешения (0,75 - 0,5 м/пиксель) для 2022 года. Охват ограничен, обновление планируется ежегодно.

Также можно самостоятельно добавлять провайдеров данных во вкладке *Providers*.

![](images/custom_imagery_source.png){fig-align="center"}

::: callout-tip
Как подключиться к некоторым провайдерам данных:

1.  How to connect to [Openaerialmap](https://docs.mapflow.ai/userguides/howto.html#oae)

2.  How to connect to [Nearmap](https://docs.mapflow.ai/userguides/howto.html#nearmap)
:::

Собственное изображение можно загрузить в формате *.GeoTIFF*.

![](images/upload_tif.png){fig-align="center"}

После завершения обработки результаты будут загружены в проект как векторный слой. Полученные результаты могут быть сохранены в формате *geojson*.

# Модуль Semi-automatic classification plugin
